---
- name: deploy deploymentclient.conf
  hosts: searchhead
  remote_user: ec2-user
  tasks:
  - name: set serverName in server.conf and host in inputs.conf
    become: true
    become_user: ec2-user
    register: out
    shell: |
      if [ -f "/opt/splunk/etc/system/local/deploymentclient.conf" ] 
      then
        echo "/opt/splunk/etc/system/local/deploymentclient.conf already exists."
      else    
      cat <<EOF >>/opt/splunk/etc/system/local/deploymentclient.conf
      [deployment-client]
      clientName = GOEL-searchead
      [target-broker:deploymentServer]
      targetUri = https://172.31.9.94:8089 
      EOF
      chmod 0600 /opt/splunk/etc/system/local/deploymentclient.conf
      fi
      
  - debug: var=out.stdout
  - debug: var=out.stderr  
    